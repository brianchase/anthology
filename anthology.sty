% Last modified: Fri 03 Jul 2015 06:12:57 PM EDT

% This software is provided 'as is', without warranty of any kind,
% either expressed or implied, including, but not limited to, the
% implied warranties of merchantability and fitness for a particular
% purpose.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{anthology}

%%%%%%%%%%%%%%%%%%%%%%%
%%  Package Options  %%
%%%%%%%%%%%%%%%%%%%%%%%

\newif\if@brackets
\newif\if@ebook
\newif\if@elptfont
\newif\if@letterpaper
\newif\if@teptfont
\newif\if@twptfont
\@teptfonttrue % The font is 10pt by default
\DeclareOption{11pt}{\@elptfonttrue\@teptfontfalse}
\DeclareOption{12pt}{\@twptfonttrue\@teptfontfalse}
\DeclareOption{brackets}{\@bracketstrue}
\DeclareOption{a4paper}{\@letterpapertrue\@ebookfalse}
\DeclareOption{annotate}{\PassOptionsToPackage{\CurrentOption}{biblatex}}
\DeclareOption{collsonly}{\PassOptionsToPackage{\CurrentOption}{biblatex}}
\DeclareOption{ebook}{\@ebooktrue\@letterpaperfalse\@twocolumnfalse}
\DeclareOption{firstshort}{\PassOptionsToPackage{\CurrentOption}{biblatex}}
\DeclareOption{letterpaper}{\@letterpapertrue\@ebookfalse}
\DeclareOption{reflist}{\PassOptionsToPackage{\CurrentOption}{biblatex}}
\DeclareOption{twocolumn}{\@bracketstrue}
\ProcessOptions

%%%%%%%%%%%%%%%%%%%%%%%%
%%  Basic Formatting  %%
%%%%%%%%%%%%%%%%%%%%%%%%

\frenchspacing
\setlength{\parindent}{1.1em}
\clubpenalty=1000
\widowpenalty=1500
\usepackage{nowidow}
\if@twocolumn
  \flushbottom
  \usepackage{fixltx2e}
  \setlength{\columnsep}{18pt}
  \sloppy
\else
  \raggedbottom
  \if@teptfont\sloppy\fi % Use '\sloppy' with option 10pt
  \if@twptfont\sloppy\fi % Use '\sloppy' with option 12pt
  \if@ebook\sloppy\fi    % Use '\sloppy' with option ebook
\fi

\if@ebook % Basic layout for ebooks:
  \setlength{\paperheight}{8.5in}
  \setlength{\paperwidth}{5.5in}
  \setlength{\evensidemargin}{-30pt}
%  \setlength{\headheight}{14pt}% Important but set below
  \setlength{\headsep}{8pt}
  \setlength{\marginparsep}{8pt}
  \setlength{\marginparwidth}{30pt}
  \setlength{\oddsidemargin}{-30pt}
  \setlength{\textheight}{38\baselineskip}
  \setlength{\textwidth}{312pt}
  \if@teptfont\setlength{\topmargin}{-4pt}\fi  % Font-specific
  \if@elptfont\setlength{\topmargin}{-34pt}\fi % Font-specific
  \if@twptfont\setlength{\topmargin}{-52pt}\fi % Font-specific
\fi

%%%%%%%%%%%%%
%%  Fonts  %%
%%%%%%%%%%%%%

\usepackage{xltxtra,xunicode,fontspec}
\defaultfontfeatures{Ligatures=TeX,Numbers={OldStyle,Proportional}}
\setmainfont[
  Extension=.otf,
  UprightFont=*-regular,
  BoldFont=*-bold,
  ItalicFont=*-italic,
  BoldItalicFont=*-bolditalic]{texgyretermes}
\newfontfamily{\greekfont}[
  Scale=MatchLowercase,
  Extension=.otf,
  UprightFont=*,
  BoldFont=*Bold,
  ItalicFont=*Italic,
  BoldItalicFont=*BoldItalic]{GFSDidot}
\usepackage[greek,american]{babel}
\newcommand{\grk}[1]{{\greekfont\foreignlanguage{greek}{#1}}}

%%%%%%%%%%%%%%%%%%
%%  Title Page  %%
%%%%%%%%%%%%%%%%%%

\renewenvironment{titlepage}
  {\cleardoublepage
   \thispagestyle{empty}%
   \setcounter{page}\@ne}%
  {\if@twoside\else
     \setcounter{page}\@ne
   \fi}%
\renewcommand{\maketitle}{%
  \begin{titlepage}
    \leavevmode\vfil
    \begin{center}
      {\Huge\itshape\@title}%
    \end{center}
    \vfil\vfil\leavevmode
    \if@twocolumn\newpage\else\clearpage\fi
  \end{titlepage}}%

%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Table of Contents  %%
%%%%%%%%%%%%%%%%%%%%%%%%%

\setcounter{tocdepth}{0}
\renewcommand{\tableofcontents}{%
  \if@twocolumn\clearpage\else\cleardoublepage\fi
  \chapter*{\contentsname
    \@mkboth{\itshape\contentsname}{\itshape\contentsname}}%
  \@starttoc{toc}}%
\renewcommand*{\l@chapter}[2]{%
  \addpenalty{-\@highpenalty}%
  \vskip 1.2ex
  \setlength\@tempdima{1.6em}%
  \begingroup
    \parindent \z@ \rightskip \@pnumwidth
    \parfillskip -\@pnumwidth
    \leavevmode \if@schap\itshape\fi
    \advance\leftskip\@tempdima
    \hskip -\leftskip
    \hangindent=1.1em\hangafter=1{#1\nobreak\hfil
    \nobreak\hb@xt@\@pnumwidth{\hss #2}}\par
    \penalty\@highpenalty
  \endgroup}%
\newif\if@schap
\newcommand*{\l@schapter}[2]{%
  \@schaptrue\l@chapter{#1}{#2}\@schapfalse}%
\def\@chapter[#1]#2{%
  \if@mainmatter
    \refstepcounter{chapter}%
    \typeout{\@chapapp\space\thechapter.}%
    \ifdefempty{\@author}
      {\addcontentsline{toc}{chapter}{%
         \protect\numberline{\thechapter}#1}}%
      {\addcontentsline{toc}{chapter}{%
         \protect\numberline{\thechapter}#1\\
         \itshape\@author}}%
  \else
    \addcontentsline{toc}{schapter}{#1}%
  \fi
  \chaptermark{#1}%
  \addtocontents{lof}{\protect\addvspace{10\p@}}%
  \addtocontents{lot}{\protect\addvspace{10\p@}}%
  \@makechapterhead{#2}%
  \@afterheading}%
\def\@schapter#1{%
  \@makeschapterhead{#1}%
  \@afterheading}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Headers and Footers  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\textit{#1}}{}}%
\fancyhf{}
\if@twocolumn
  \setlength{\headheight}{24pt}
  \lhead{\parbox{\columnwidth}{\centering\itshape\@title}}%
  \rhead{\parbox{\columnwidth}{\centering\leftmark}}%
  \fancyfoot[C]{\thepage}
\else
  \setlength{\headheight}{14pt}
  \fancyhead[LE,RO]{\thepage}
  \fancyhead[CO]{\leftmark}
  \fancyhead[CE]{\itshape\@title}
\fi
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

%%%%%%%%%%%%%%%%
%%  Headings  %%
%%%%%%%%%%%%%%%%

\usepackage[clearempty,explicit]{titlesec}
\setcounter{secnumdepth}{0}
\titleformat{\chapter}[display]
  {\thispagestyle{empty}
   \huge\filcenter}{\liningnums{\thechapter}}{0ex}
  {\vbox to 7.8ex{% font-specific
     \LARGE\itshape #1\vskip 0.2ex
     \@addon\normalfont\normalsize\@textdate\vfil}}
  [\vbox to 5ex{%
     \normalfont\large\@author\vskip 0.2ex
     \normalsize\@authdate\vfil}%
   \gdef\@textdate{}%
   \gdef\@author{}%
   \gdef\@authdate{}%
   \gdef\@addon{}]
\titleformat{\section}
  {\normalfont\bfseries\filcenter}{\thesection.}{2ex}{#1}
\titleformat{\subsection}
  {\normalfont\bfseries\filcenter}{\thesubsection.}{2ex}{#1}
\titleformat{\subsubsection}
  {\normalfont\bfseries\filcenter}{\thesubsubsection.}{2ex}{#1}
\titleformat{\paragraph}[runin]
  {\normalfont\normalsize\bfseries}{\theparagraph}{2ex}{#1}
\titleformat{\subparagraph}[runin]
  {\normalfont\normalsize\bfseries}{\thesubparagraph}{2ex}{#1}
\titlespacing*{\chapter}{4ex}{-\topskip}{8ex}[4ex]
\titlespacing*{\section}
  {4ex}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}[4ex]
\titlespacing*{\subsection}
  {4ex}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}[4ex]
\titlespacing*{\subsubsection}
  {4ex}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}[4ex]
\renewcommand{\@makeschapterhead}[1]{%
  \thispagestyle{empty}%
  \begin{center}
    \LARGE\itshape #1
  \end{center}
  \vskip 6ex}%

%%%%%%%%%%%%%
%%  Notes  %%
%%%%%%%%%%%%%

\usepackage[backend=biber,style=windycity]{biblatex}
\bibliography{anthology}
\setlength{\bibhang}{1.1em}
\setlength{\bibitemsep}{1.2ex}% To align with TOC
\AtBeginBibliography{\vskip 1.2ex}% To align with TOC
\defbibheading{bibliography}{%
  \chapter*{Bibliography}
  \addcontentsline{toc}{schapter}{Bibliography}
  \markright{Bibliography}}%
\defbibheading{references}{%
  \chapter*{References}
  \addcontentsline{toc}{schapter}{References}
  \markright{References}}%
\usepackage{csquotes}
\usepackage[stable]{footmisc}
\renewcommand{\@makefntext}[1]{%
  \parindent 1em%
  \normalfont\@thefnmark.\hspace{0.4em}#1}%
\renewcommand{\@makefnmark}{%
  \hbox{\@textsuperscript{\liningnums{\@thefnmark}}}}
\newcommand{\source}{%
  \@ifstar
    {\@ifnextchar[{\@xfootnote}{\@xfootnote[]}}%
    {\@ifnextchar[{\@yfootnote}{\@yfootnote[]}}}
\def\@xfootnote[#1]#2{%
  \@zfootnote{Republished~from~\fullcite*[#1]{#2}}}
\def\@yfootnote[#1]#2{%
  \@zfootnote{Republished~from~\fullcite[#1]{#2}}}
\newcommand{\@zfootnote}[1]{%
  \insert\footins{\normalfont\footnotesize
  \interlinepenalty\interfootnotelinepenalty
  \splittopskip\footnotesep
  \splitmaxdepth \dp\strutbox \floatingpenalty \@MM
  \hsize\columnwidth \@parboxrestore
  \footnoterule
  {\rule{\z@}{\footnotesep}\ignorespaces
    #1\strut}}}
\if@brackets\else
  \usepackage{marginnote}
  \renewcommand{\marginfont}{\normalfont\small}%
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%  Original Source Page Breaks  %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\if@brackets
  \newcommand{\page}[1]{$\,$[#1]$\,$}%
\else
% The command below is from marginnote.sty. Adding '\nobreak' prevents
% a page break between '\marginnote' and the text that follows it.
  \renewcommand{\mn@vlap}[1]{%
    \setbox\@tempboxa\vbox to \ht\strutbox{#1\vss}%
    \box\@tempboxa\nobreak\vskip-\baselineskip}%
  \newcommand{\page}[1]{%
    \renewcommand{\@mypage}{#1}%
    \futurelet\@mytoken\@pageparse}%
  \newcommand{\@mypage}{}%
  \newcommand{\@pageparse}{%
    \ifx\@mytoken\section\@wpage\else\@xpage\fi}%
  \newcommand{\@wpage}{%
    \if@nobreak
      \marginnote{\@mypage}%
    \else
      \vspace{\sectionskip}%
      \marginnote{\@mypage}\nobreak
    \fi
    \@afterindentfalse\@afterheading}%
  \newlength{\sectionskip}
  \setlength{\sectionskip}{3.25ex \@plus 1ex \@minus .2ex}
  \newcommand{\@xpage}{%
    \ifx\@mytoken\begin\@ypage\else\@zpage\fi}%
  \newcommand{\@ypage}{%
    \if@nobreak\else
      \vspace{\partopsep}%
      \vspace{\topsep}%
    \fi
    \marginnote{\@mypage}\nobreak
    \@afterindentfalse\@afterheading}%
  \newcommand{\@zpage}{%
    \ifvmode
      \if@nobreak
        \marginnote{\@mypage}\nobreak
        \@afterindentfalse\@afterheading
      \else
        \ifthenelse{\equal{verse}{\@currenvir}}
          {\marginnote{\@mypage}[\verseadj]}%
          {\marginnote{\@mypage}}%
        \nobreak
      \fi
    \else
      \unskip
      \cleaders\copy\brkbox\hskip\wd\brkbox
      \marginnote{\@mypage}\ignorespaces
    \fi}%
  \newlength{\verseadj}
  \setlength{\verseadj}{% Font-specific; assumes OldStyle
    \if@teptfont 6.2pt\fi\if@elptfont 6.4pt\fi\if@twptfont 7pt\fi}%
  \newsavebox{\brkbox}%
  \sbox{\brkbox}{$\,|\,$}%
\fi

%%%%%%%%%%%%%%%%%%%%%%%%
%%  Fields and Links  %%
%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\authdate}[1]{\ifblank{#1}{}{\gdef\@authdate{(#1)}}}
\newcommand{\textdate}[1]{\ifblank{#1}{}{\gdef\@textdate{(#1)}}}
\newcommand{\version}[1]{\gdef\@version{\liningnums{#1}}}%
\gdef\@author{}%
\gdef\@authdate{}%
\gdef\@textdate{}%
\gdef\@version{}%
\newcommand{\addon}{\@ifnextchar[{\@xaddon}{\@yaddon}}%
\def\@xaddon[#1]#2{\gdef\@addon{\large#2\\[0.2ex]#1\\[0.2ex]}}%
\def\@yaddon#1{\gdef\@addon{\large#1\\[0.2ex]}}%
\gdef\@addon{}%
\renewcommand{\title}[1]{%
  \gdef\@title{#1}%
  \hypersetup{pdftitle=\@title}}%
\newcommand{\printversion}{%
  \begin{center}
    {\small\emph{\@title}\\version \@version}%
  \end{center}}%

%%%%%%%%%%%%%%%%%%%%%
%%  Miscellaneous  %%
%%%%%%%%%%%%%%%%%%%%%

\usepackage{enumitem}% For lists
\usepackage{graphicx}% For images
\if@twocolumn
  \newenvironment{multicols}[1]{}{}% Disable multicols
\else
  \usepackage{multicol}% For multi-column text
\fi
\usepackage{verse}% Handy for longer poems

\AtBeginEnvironment{description}{\small}
\AtBeginEnvironment{quotation}{\small}
\AtBeginEnvironment{quote}{\small}
\AtBeginEnvironment{tabular}{\small}
\AtBeginEnvironment{verse}{\small}

% For enumitem:
\setlist{noitemsep}
\setlist[description]{font=\bfseries,format=\addcolon}
\newcommand{\addcolon}[1]{#1:}%

% For verse:
\setlength{\afterpoemtitleskip}{1.5ex \@plus.2ex}
\setlength{\beforepoemtitleskip}{0pt}
\renewcommand{\poemtitlefont}{\scshape\centering}%
\setlength{\vgap}{\parindent}
\setlength{\vleftskip}{\parindent}
\newcommand{\attrib}[1]{%
  \nopagebreak{\hfil\hfil\small\textsc{#1}\medskip}}%
\newcommand{\poke}[1]{\makebox[0pt][r]{#1}}%

% For abstracts and the like:
\newenvironment{abstract}[2][]
  {\ifblank{#1}{}{\section*{#1}}%
   \ifthenelse{\equal{#2}{c}\OR
                 \equal{#2}{h}}
     {\ifstrequal{#2}{c}{\@abcent}{}%
      \ifstrequal{#2}{h}{\@abhang}{}}%
    {\ifblank{#2}{\@abnone}{\@abnone #2}}}
  {\endlist}%
\newcommand{\@abcent}{%
  \trivlist\small\itshape\centering\item\relax}%
\newcommand{\@abhang}{%
  \list{}{%
    \small\itshape
    \leftmargin=\parindent
    \parsep=\parskip
    \listparindent=\parindent
    \itemindent=-\parindent}%
  \item\relax}%
\newcommand{\@abnone}{\trivlist\small\itshape\item\relax}%

% For the Declaration of Independence:
\newenvironment{decliststates}
  {\if@ebook
     \begin{multicols}{2}\raggedright
     \begin{itemize}[itemsep=8pt,label=,labelsep=*]\small
   \else
     \begin{multicols}{3}\raggedright
     \begin{itemize}[wide,itemsep=8pt,label=,labelsep=*]\small
   \fi}%
  {\end{itemize}
   \end{multicols}}%
\newenvironment{declistnames}
  {\if@ebook
     \begin{itemize}[label=,labelsep=*,leftmargin=0em,
                       itemsep=0pt,topsep=0pt]
   \else
     \begin{itemize}[wide,label=,itemsep=0pt,topsep=0pt]
   \fi}%
  {\end{itemize}}%

\newcommand{\BCE}{\small{BCE}}%
\newcommand{\CE}{\small{CE}}%
\hyphenation{Al-ex-an-der Hough-ton mor-als Wil-liam}% For citations
\newcommand{\llb}{\if@elptfont\if@letterpaper\linebreak[4]\fi\fi}%
\newcommand{\maxwidth}{%
  \ifdim\Gin@nat@width>\columnwidth \columnwidth
  \else\Gin@nat@width\fi}%
\newcommand{\snip}{%
  \vskip 1ex{\centering
  \textasteriskcentered~\textasteriskcentered~\textasteriskcentered
  \par}\vskip 1ex}%

\usepackage[%
  anchorcolor=black,
  breaklinks=true,
  citecolor=black,
  colorlinks=true,
  linkcolor=black,
  unicode,
  urlcolor=black]{hyperref}
\urlstyle{same}% Put urls in normal font. Must not precede hyperref.

\endinput
